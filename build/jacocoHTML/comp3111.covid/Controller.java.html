<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controller.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">deCOVID</a> &gt; <a href="index.source.html" class="el_package">comp3111.covid</a> &gt; <span class="el_source">Controller.java</span></div><h1>Controller.java</h1><pre class="source lang-java linenums">package comp3111.covid;

import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;

import comp3111.covidEntity.CovidRecord;
import comp3111.tableColumns.ConfirmedCaseTable;
import comp3111.tableColumns.DeathCaseTable;
import comp3111.tableColumns.VaccinationTable;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.event.Event;
import javafx.fxml.FXML;
import javafx.scene.chart.LineChart;
import javafx.scene.chart.NumberAxis;
import javafx.scene.chart.XYChart;
import javafx.scene.control.Button;
import javafx.scene.control.CheckBox;
import javafx.scene.control.MenuButton;
import javafx.scene.control.MenuItem;
import javafx.scene.control.Tab;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.control.CustomMenuItem;
import javafx.scene.control.DatePicker;
import javafx.scene.control.Label;

/**
 * Building on the sample skeleton for 'ui.fxml' Controller Class generated by
 * SceneBuilder
 */
<span class="fc" id="L40">public class Controller {</span>
	// initial setup
	/**
	 * Task Zero
	 * To be triggered by the &quot;Confirmed Cases&quot; button on the Task Zero Tab
	 * 
	 */
	@FXML
	void doConfirmedCases(ActionEvent event) {
<span class="nc" id="L49">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L50">		String iISO = textfieldISO.getText();</span>
<span class="nc" id="L51">		String oReport = DataAnalysis.getConfirmedCases(iDataset, iISO);</span>
<span class="nc" id="L52">		textAreaConsole.setText(oReport);</span>
<span class="nc" id="L53">	}</span>

	/**
	 * Task Zero
	 * To be triggered by the &quot;Confirmed Deaths&quot; button on the Task Zero Tab
	 * 
	 */
	@FXML
	void doConfirmedDeaths(ActionEvent event) {
<span class="nc" id="L62">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L63">		String iISO = textfieldISO.getText();</span>
<span class="nc" id="L64">		String oReport = DataAnalysis.getConfirmedDeaths(iDataset, iISO);</span>
<span class="nc" id="L65">		textAreaConsole.setText(oReport);</span>
<span class="nc" id="L66">	}</span>

	/**
	 * Task Zero
	 * To be triggered by the &quot;Rate of Vaccination&quot; button on the Task Zero Tab
	 * 
	 */
	@FXML
	void doRateOfVaccination(ActionEvent event) {
<span class="nc" id="L75">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L76">		String iISO = textfieldISO.getText();</span>
<span class="nc" id="L77">		String oReport = DataAnalysis.getRateOfVaccination(iDataset, iISO);</span>
<span class="nc" id="L78">		textAreaConsole.setText(oReport);</span>
<span class="nc" id="L79">	}</span>

	@FXML
	private Button buttonConfirmedCases;

	@FXML
	private Button buttonConfirmedDeaths;

	@FXML
	private Button buttonRateOfVaccination;

	@FXML
	private Tab tabApp1;

	@FXML
	private Tab tabApp2;

	@FXML
	private Tab tabApp3;

	@FXML
	private Tab tabReport1;

	@FXML
	private Tab tabReport2;

	@FXML
	private Tab tabReport3;

	@FXML
	private Tab tabTaskZero;

	@FXML
	private TextArea textAreaConsole;

	@FXML
	private TextField textfieldDataset;

	@FXML
	private TextField textfieldISO;
	
	// initialize the controller class
<span class="fc" id="L121">	private final List&lt;String&gt; prioritizedCountries = Arrays.asList(&quot;Hong Kong&quot;, &quot;India&quot;, &quot;Israel&quot;, &quot;Japan&quot;, &quot;Macao&quot;, &quot;Singapore&quot;, &quot;United Kingdom&quot;,  &quot;World&quot;);</span>

	public void initialize() {
<span class="fc" id="L124">		String iDataset = textfieldDataset.getText();</span>
<span class="fc" id="L125">		DataAnalysis.initCountriesDict(iDataset);</span>
<span class="fc" id="L126">		List&lt;String&gt; countries = new ArrayList&lt;String&gt;(DataAnalysis.countriesDict.values());</span>
<span class="fc" id="L127">		Collections.sort(countries);</span>
<span class="fc" id="L128">		Collections.reverse(prioritizedCountries);</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">		for (String prioritizedCountry: prioritizedCountries){</span>
<span class="fc" id="L130">			countries.remove(prioritizedCountry);</span>
<span class="fc" id="L131">			countries.add(0, prioritizedCountry);</span>
<span class="fc" id="L132">		}</span>

<span class="fc bfc" id="L134" title="All 2 branches covered.">		for (MenuButton menuButton : Arrays.asList(tableA_countriesPicker, chartA_countriesPicker,</span>
				tableB_countriesPicker, chartB_countriesPicker,
				tableC_countriesPicker, chartC_countriesPicker)) {
<span class="fc bfc" id="L137" title="All 2 branches covered.">			for (String country : countries) {</span>
<span class="fc" id="L138">				CheckBox checkBox = new CheckBox(country);</span>
<span class="fc" id="L139">				CustomMenuItem customMenuItem = new CustomMenuItem(checkBox);</span>
<span class="fc" id="L140">				customMenuItem.setHideOnClick(false);</span>
<span class="fc" id="L141">				menuButton.getItems().add(customMenuItem);</span>
<span class="fc" id="L142">			}</span>
<span class="pc" id="L143">			menuButton.setOnHiding((event) -&gt; handleMenuClose(event));</span>
<span class="fc" id="L144">		}</span>
<span class="fc" id="L145">		tableA_countryColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;country&quot;));</span>
<span class="fc" id="L146">		tableA_totalCasesColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;totalCases&quot;));</span>
<span class="fc" id="L147">		tableA_totalCasesPerMillionColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;totalCasesPerMillion&quot;));</span>

<span class="fc" id="L149">		tableB_countryColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;country&quot;));</span>
<span class="fc" id="L150">		tableB_totalDeathsColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;totalDeaths&quot;));</span>
<span class="fc" id="L151">		tableB_totalDeathsPerMillionColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;totalDeathsPerMillion&quot;));</span>

<span class="fc" id="L153">		tableC_countryColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;country&quot;));</span>
<span class="fc" id="L154">		tableC_fullyVaccinatedColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;fullyVaccinated&quot;));</span>
<span class="fc" id="L155">		tableC_rateOfVaccinationColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;rateOfVaccination&quot;));</span>

<span class="fc" id="L157">		chartA_lineChart.setTitle(&quot;Cumulative Confirmed COVID-19 Cases (per 1M)&quot;);</span>
<span class="fc" id="L158">		chartA_lineChart.setCreateSymbols(false);</span>
<span class="fc" id="L159">		chartB_lineChart.setCreateSymbols(false);</span>
<span class="fc" id="L160">		chartC_lineChart.setCreateSymbols(false);</span>

<span class="fc" id="L162">		chartA_yAxis.setTickLabelFormatter(new NumberAxis.DefaultFormatter(chartA_yAxis, null, &quot;&quot;));</span>
<span class="fc" id="L163">		chartA_xAxis.setTickLabelFormatter(xAxisLabelFactory(chartA_xAxis));</span>

<span class="fc" id="L165">		chartB_yAxis.setTickLabelFormatter(new NumberAxis.DefaultFormatter(chartB_yAxis, null, &quot;Million&quot;));</span>
<span class="fc" id="L166">		chartB_xAxis.setTickLabelFormatter(xAxisLabelFactory(chartB_xAxis));</span>

<span class="fc" id="L168">		chartC_yAxis.setTickLabelFormatter(new NumberAxis.DefaultFormatter(chartC_yAxis, null, &quot;%&quot;));</span>
<span class="fc" id="L169">		chartC_xAxis.setTickLabelFormatter(xAxisLabelFactory(chartC_xAxis));</span>


<span class="fc" id="L172">	}</span>

	// Table input validation
	public boolean tableInputValidate(LocalDate date, List&lt;String&gt; iISOs) {
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">		if (date == null) {</span>
<span class="fc" id="L177">			textAreaConsole.setText(&quot;Input Error: Please input start date.&quot;);</span>
<span class="fc" id="L178">			return false;</span>
		}
<span class="nc bnc" id="L180" title="All 2 branches missed.">		if (iISOs.isEmpty()) {</span>
<span class="nc" id="L181">			textAreaConsole.setText(&quot;Input Error: Please select countries.&quot;);</span>
<span class="nc" id="L182">			return false;</span>
		}
<span class="nc" id="L184">		return true;</span>
	}

	// Chart input validation
	public boolean chartInputValidate(LocalDate iStartDate, LocalDate iEndDate, List&lt;String&gt; iISOs) {
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if (iStartDate == null) {</span>
<span class="nc" id="L190">			textAreaConsole.setText(&quot;Input Error: Please input start date.&quot;);</span>
<span class="nc" id="L191">			return false;</span>
		}
<span class="nc bnc" id="L193" title="All 2 branches missed.">		if (iEndDate == null) {</span>
<span class="nc" id="L194">			textAreaConsole.setText(&quot;Input Error: Please input end date.&quot;);</span>
<span class="nc" id="L195">			return false;</span>
		}
<span class="nc bnc" id="L197" title="All 2 branches missed.">		if (iStartDate.isAfter(iEndDate)) {</span>
<span class="nc" id="L198">			textAreaConsole.setText(&quot;Input Error: Please set start date before end date.&quot;);</span>
<span class="nc" id="L199">			return false;</span>
		}
<span class="nc bnc" id="L201" title="All 2 branches missed.">		if (iISOs.isEmpty()) {</span>
<span class="nc" id="L202">			textAreaConsole.setText(&quot;Input Error: Please select countries.&quot;);</span>
<span class="nc" id="L203">			return false;</span>
		}
<span class="nc bnc" id="L205" title="All 2 branches missed.">		if (iISOs.size() &gt; 20) {</span>
<span class="nc" id="L206">			textAreaConsole.setText(&quot;Warning: Over 20 countries selected. Please select less for better experience.&quot;);</span>
<span class="nc" id="L207">			return false;</span>
		}
<span class="nc" id="L209">		return true;</span>
	}

	// display epoch values in x axis as date
	public NumberAxis.DefaultFormatter xAxisLabelFactory(NumberAxis xAxis) {
<span class="fc" id="L214">		return new NumberAxis.DefaultFormatter(xAxis) {</span>
			@Override
			public String toString(final Number object) {
<span class="fc" id="L217">				Long longValue = object.longValue();</span>
<span class="fc" id="L218">				LocalDate date = LocalDate.ofEpochDay(longValue);</span>
<span class="fc" id="L219">				DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;dd LLLL yyyy&quot;);</span>
<span class="fc" id="L220">				return date.format(formatter);</span>
			}
		};
	}

	// Table A - Confirmed cases table

	@FXML
	private MenuButton tableA_countriesPicker;

	@FXML
	private DatePicker tableA_date;

	@FXML
	private Button tableA_submitButton;

	@FXML
	private TableView&lt;ConfirmedCaseTable&gt; tableA_tableView;

	@FXML
	private TableColumn&lt;?, ?&gt; tableA_countryColumn;

	@FXML
	private TableColumn&lt;?, ?&gt; tableA_totalCasesColumn;

	@FXML
	private TableColumn&lt;?, ?&gt; tableA_totalCasesPerMillionColumn;

	@FXML
	void submitTableA(ActionEvent event) {
<span class="nc" id="L250">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L251">		LocalDate iDate = tableA_date.getValue();</span>
<span class="nc" id="L252">		List&lt;String&gt; iISOCodes = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L253">		HashMap&lt;String, String&gt; invertedCountriesDict = new HashMap&lt;String, String&gt;();</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">		for (String ISOCode : DataAnalysis.countriesDict.keySet()) {</span>
<span class="nc" id="L255">			invertedCountriesDict.put(DataAnalysis.countriesDict.get(ISOCode), ISOCode);</span>
<span class="nc" id="L256">		}</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">		for (MenuItem item : tableA_countriesPicker.getItems()) {</span>
<span class="nc" id="L258">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="nc" id="L259">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L261">				String ISOCode = invertedCountriesDict.get(checkBox.getText());</span>
<span class="nc" id="L262">				iISOCodes.add(ISOCode);</span>
			}
<span class="nc" id="L264">		}</span>

<span class="nc bnc" id="L266" title="All 2 branches missed.">		if (!tableInputValidate(iDate, iISOCodes))</span>
<span class="nc" id="L267">			return;</span>

<span class="nc" id="L269">		HashMap&lt;String, CovidRecord&gt; casesTable = DataAnalysis.getCasesTable(iDataset, iDate, iISOCodes);</span>
<span class="nc" id="L270">		tableA_tableView.getItems().clear();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">		for (var key : casesTable.keySet()) {</span>
<span class="nc" id="L272">			var rec = casesTable.get(key);</span>
			ConfirmedCaseTable entry;
<span class="nc bnc" id="L274" title="All 2 branches missed.">			if (rec == null)</span>
<span class="nc" id="L275">				entry = new ConfirmedCaseTable(DataAnalysis.countriesDict.get(key), &quot;Data not found&quot;, &quot;Data not found&quot;);</span>
			else
<span class="nc" id="L277">				entry = new ConfirmedCaseTable(DataAnalysis.countriesDict.get(key),</span>
<span class="nc" id="L278">						rec.confirmedCaseRecord.totalCases.toString(),</span>
<span class="nc" id="L279">						rec.confirmedCaseRecord.totalCasesPerMillion.toString());</span>
<span class="nc" id="L280">			tableA_tableView.getItems().add(entry);</span>
<span class="nc" id="L281">		}</span>

<span class="nc" id="L283">		textAreaConsole.setText(&quot;COVID-19 cases table generated successfully.&quot;);</span>
<span class="nc" id="L284">	}</span>

	// ChartA - Confirmed cases chart
	@FXML
	private MenuButton chartA_countriesPicker;

	@FXML
	private DatePicker chartA_endDate;

	@FXML
	private DatePicker chartA_startDate;

	@FXML
	private Button chartA_submitButton;

	@FXML
	private LineChart&lt;Long, Float&gt; chartA_lineChart;

	@FXML
	private NumberAxis chartA_xAxis;

	@FXML
	private NumberAxis chartA_yAxis;

	@FXML
	void submitChartA(ActionEvent event) {
<span class="nc" id="L310">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L311">		LocalDate iStartDate = chartA_startDate.getValue();</span>
<span class="nc" id="L312">		LocalDate iEndDate = chartA_endDate.getValue();</span>

<span class="nc" id="L314">		List&lt;String&gt; ilocations = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">		for (MenuItem item : chartA_countriesPicker.getItems()) {</span>
<span class="nc" id="L316">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="nc" id="L317">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L319">				String location = checkBox.getText();</span>
<span class="nc" id="L320">				ilocations.add(location);</span>
<span class="nc" id="L321">				System.out.println(location);</span>
			}
<span class="nc" id="L323">		}</span>

<span class="nc bnc" id="L325" title="All 2 branches missed.">		if (!chartInputValidate(iStartDate, iEndDate, ilocations))</span>
<span class="nc" id="L326">			return;</span>

<span class="nc" id="L328">		chartA_xAxis.setAutoRanging(false);</span>
<span class="nc" id="L329">		chartA_xAxis.setLowerBound(iStartDate.toEpochDay());</span>
<span class="nc" id="L330">		chartA_xAxis.setUpperBound(iEndDate.toEpochDay());</span>

<span class="nc" id="L332">		HashMap&lt;String, List&lt;FloatCoordinates&gt;&gt; casesChart = DataAnalysis.getCasesChart(iDataset, iStartDate, iEndDate,</span>
				ilocations);
<span class="nc" id="L334">		chartA_lineChart.getData().clear();</span>
<span class="nc" id="L335">		casesChart.forEach((location, line) -&gt; {</span>
<span class="nc" id="L336">			XYChart.Series&lt;Long, Float&gt; series = new XYChart.Series&lt;&gt;();</span>
<span class="nc" id="L337">			series.setName(location);</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">			for (FloatCoordinates coordinates : line) {</span>
<span class="nc" id="L339">				series.getData().add(new XYChart.Data&lt;&gt;(coordinates.getDate().toEpochDay(), coordinates.getValue()));</span>
<span class="nc" id="L340">			}</span>
<span class="nc" id="L341">			chartA_lineChart.getData().add(series);</span>
<span class="nc" id="L342">		});</span>

<span class="nc" id="L344">		textAreaConsole.setText(&quot;COVID-19 cases chart generated successfully.&quot;);</span>
<span class="nc" id="L345">	}</span>

	// Table C - Vaccination record table
	@FXML
	private MenuButton tableC_countriesPicker;

	@FXML
	private TableColumn&lt;?, ?&gt; tableC_countryColumn;

	@FXML
	private DatePicker tableC_date;

	@FXML
	private TableView&lt;VaccinationTable&gt; tableC_tableView;

	@FXML
	private TableColumn&lt;VaccinationTable, String&gt; tableC_fullyVaccinatedColumn;

	@FXML
	private TableColumn&lt;VaccinationTable, String&gt; tableC_rateOfVaccinationColumn;

	@FXML
	void submitTableC(ActionEvent event) {
<span class="fc" id="L368">		String iDataset = textfieldDataset.getText();</span>
<span class="fc" id="L369">		LocalDate iDate = tableC_date.getValue();</span>

<span class="fc" id="L371">		List&lt;String&gt; ilocations = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L372" title="All 2 branches covered.">		for (MenuItem item: tableC_countriesPicker.getItems()) {</span>
<span class="fc" id="L373">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="fc" id="L374">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="pc bpc" id="L375" title="1 of 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L376">				String location = checkBox.getText();</span>
<span class="nc" id="L377">				ilocations.add(location);</span>
			}
<span class="fc" id="L379">		}</span>

<span class="pc bpc" id="L381" title="1 of 2 branches missed.">		if (!tableInputValidate(iDate, ilocations))</span>
<span class="fc" id="L382">			return;</span>

<span class="nc" id="L384">		HashMap&lt;String, VaccinationTable&gt; vaccineReport = DataAnalysis.getVaccinationTable(iDataset, iDate, ilocations);</span>
<span class="nc" id="L385">		tableC_tableView.getItems().clear();</span>
<span class="nc" id="L386">		vaccineReport.forEach((location, row) -&gt; {</span>
<span class="nc" id="L387">			tableC_tableView.getItems().add(row);</span>
<span class="nc" id="L388">		});</span>
<span class="nc" id="L389">		textAreaConsole.setText(&quot;COVID-19 vaccination rate table generated successfully.&quot;);</span>
<span class="nc" id="L390">	}</span>

	// ChartC - Vaccination chart

	@FXML
	private MenuButton chartC_countriesPicker;

	@FXML
	private DatePicker chartC_endDate;

	@FXML
	private DatePicker chartC_startDate;

	@FXML
	private Button chartC_submitButton;

	@FXML
	private LineChart&lt;Long, Float&gt; chartC_lineChart;

	@FXML
	private NumberAxis chartC_xAxis;

	@FXML
	private NumberAxis chartC_yAxis;

	@FXML
	void submitChartC(ActionEvent event) {
<span class="nc" id="L417">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L418">		LocalDate iStartDate = chartC_startDate.getValue();</span>
<span class="nc" id="L419">		LocalDate iEndDate = chartC_endDate.getValue();</span>

<span class="nc" id="L421">		List&lt;String&gt; ilocations = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">		for (MenuItem item : chartC_countriesPicker.getItems()) {</span>
<span class="nc" id="L423">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="nc" id="L424">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L426">				String location = checkBox.getText();</span>
<span class="nc" id="L427">				ilocations.add(location);</span>
			}
<span class="nc" id="L429">		}</span>

<span class="nc bnc" id="L431" title="All 2 branches missed.">		if (!chartInputValidate(iStartDate, iEndDate, ilocations))</span>
<span class="nc" id="L432">			return;</span>

<span class="nc" id="L434">		chartC_xAxis.setAutoRanging(false);</span>
<span class="nc" id="L435">		chartC_xAxis.setLowerBound(iStartDate.toEpochDay());</span>
<span class="nc" id="L436">		chartC_xAxis.setUpperBound(iEndDate.toEpochDay());</span>

<span class="nc" id="L438">		HashMap&lt;String, List&lt;FloatCoordinates&gt;&gt; vaccineChart = DataAnalysis.getVaccinationChart(iDataset, iStartDate,</span>
				iEndDate, ilocations);
<span class="nc" id="L440">		chartC_lineChart.getData().clear();</span>
<span class="nc" id="L441">		vaccineChart.forEach((location, line) -&gt; {</span>
<span class="nc" id="L442">			XYChart.Series&lt;Long, Float&gt; series = new XYChart.Series&lt;&gt;();</span>
<span class="nc" id="L443">			series.setName(location);</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">			for (FloatCoordinates coordinates: line) {</span>
<span class="nc" id="L445">				series.getData().add(new XYChart.Data&lt;&gt;(coordinates.getDate().toEpochDay(), coordinates.getValue()));</span>
<span class="nc" id="L446">			}</span>
<span class="nc" id="L447">			chartC_lineChart.getData().addAll(series);</span>
<span class="nc" id="L448">		});</span>

<span class="nc" id="L450">		textAreaConsole.setText(&quot;COVID-19 vaccination rate chart generated successfully.&quot;);</span>
<span class="nc" id="L451">	}</span>

	// Table B - Deaths table

    @FXML
    private MenuButton tableB_countriesPicker;

    @FXML
    private TableColumn&lt;?, ?&gt; tableB_countryColumn;

    @FXML
    private DatePicker tableB_date;

    @FXML
    private CheckBox tableB_selectAll;

    @FXML
    private Button tableB_submitButton;

    @FXML
    private Tab tableB_tab;

    @FXML
    private TableView&lt;DeathCaseTable&gt; tableB_tableView;

    @FXML
    private Label tableB_title;

    @FXML
    private TableColumn&lt;?, ?&gt; tableB_totalDeathsColumn;

    @FXML
    private TableColumn&lt;?, ?&gt; tableB_totalDeathsPerMillionColumn;

	@FXML
	void submitTableB(ActionEvent event) {
<span class="nc" id="L487">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L488">		LocalDate iDate = tableB_date.getValue();</span>
<span class="nc" id="L489">		List&lt;String&gt; iISOCodes = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L490">		HashMap&lt;String, String&gt; invertedCountriesDict = new HashMap&lt;String, String&gt;();</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">		for (String ISOCode : DataAnalysis.countriesDict.keySet()) {</span>
<span class="nc" id="L492">			invertedCountriesDict.put(DataAnalysis.countriesDict.get(ISOCode), ISOCode);</span>
<span class="nc" id="L493">		}</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">		for (MenuItem item : tableB_countriesPicker.getItems()) {</span>
<span class="nc" id="L495">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="nc" id="L496">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L498">				String ISOCode = invertedCountriesDict.get(checkBox.getText());</span>
<span class="nc" id="L499">				iISOCodes.add(ISOCode);</span>
			}
<span class="nc" id="L501">		}</span>


<span class="nc bnc" id="L504" title="All 2 branches missed.">		if (!tableInputValidate(iDate, iISOCodes))</span>
<span class="nc" id="L505">			return;</span>

<span class="nc" id="L507">			HashMap&lt;String, CovidRecord&gt; casesTable = DataAnalysis.getCasesTable(iDataset, iDate, iISOCodes);</span>
<span class="nc" id="L508">		tableB_tableView.getItems().clear();</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">		for (var key : casesTable.keySet()) {</span>
<span class="nc" id="L510">			var rec = casesTable.get(key);</span>
			DeathCaseTable entry;
<span class="nc bnc" id="L512" title="All 2 branches missed.">			if (rec == null)</span>
<span class="nc" id="L513">				entry = new DeathCaseTable(DataAnalysis.countriesDict.get(key), &quot;Data not found&quot;, &quot;Data not found&quot;);</span>
			else
<span class="nc" id="L515">				entry = new DeathCaseTable(DataAnalysis.countriesDict.get(key),</span>
<span class="nc" id="L516">						rec.confirmedDeathRecord.totalDeaths.toString(),</span>
<span class="nc" id="L517">						rec.confirmedDeathRecord.totalDeathsPerMillion.toString());</span>
<span class="nc" id="L518">			tableB_tableView.getItems().add(entry);</span>
<span class="nc" id="L519">		}</span>

<span class="nc" id="L521">		textAreaConsole.setText(&quot;COVID-19 deaths table generated successfully.&quot;);</span>
<span class="nc" id="L522">	}</span>

	// Task B2

	@FXML
    private MenuButton chartB_countriesPicker;

    @FXML
    private DatePicker chartB_endDate;

    @FXML
    private LineChart&lt;Long, Float&gt; chartB_lineChart;

    @FXML
    private CheckBox chartB_selectAll;

    @FXML
    private DatePicker chartB_startDate;

    @FXML
    private Button chartB_submitButton;

    @FXML
    private Tab chartB_tab;

    @FXML
    private Label chartB_title;

    @FXML
    private NumberAxis chartB_xAxis;

    @FXML
    private NumberAxis chartB_yAxis;
	
	@FXML
	void submitChartB(ActionEvent event) {
<span class="nc" id="L558">		String iDataset = textfieldDataset.getText();</span>
<span class="nc" id="L559">		LocalDate iStartDate = chartB_startDate.getValue();</span>
<span class="nc" id="L560">		LocalDate iEndDate = chartB_endDate.getValue();</span>

<span class="nc" id="L562">		List&lt;String&gt; ilocations = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">		for (MenuItem item : chartB_countriesPicker.getItems()) {</span>
<span class="nc" id="L564">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="nc" id="L565">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L567">				String location = checkBox.getText();</span>
<span class="nc" id="L568">				ilocations.add(location);</span>
			}
<span class="nc" id="L570">		}</span>

<span class="nc bnc" id="L572" title="All 2 branches missed.">		if (!chartInputValidate(iStartDate, iEndDate, ilocations))</span>
<span class="nc" id="L573">			return;</span>

<span class="nc" id="L575">		chartB_xAxis.setAutoRanging(false);</span>
<span class="nc" id="L576">		chartB_xAxis.setLowerBound(iStartDate.toEpochDay());</span>
<span class="nc" id="L577">		chartB_xAxis.setUpperBound(iEndDate.toEpochDay());</span>

<span class="nc" id="L579">		HashMap&lt;String, List&lt;FloatCoordinates&gt;&gt; deathChart = DataAnalysis.getDeathsChart(iDataset, iStartDate,</span>
				iEndDate, ilocations);
<span class="nc" id="L581">		chartB_lineChart.getData().clear();</span>
<span class="nc" id="L582">		deathChart.forEach((location, line) -&gt; {</span>
<span class="nc" id="L583">			XYChart.Series&lt;Long, Float&gt; series = new XYChart.Series&lt;&gt;();</span>
<span class="nc" id="L584">			series.setName(location);</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">			for (FloatCoordinates coordinates : line) {</span>
<span class="nc" id="L586">				series.getData().add(new XYChart.Data&lt;&gt;(coordinates.getDate().toEpochDay(), coordinates.getValue()));</span>
<span class="nc" id="L587">			}</span>
<span class="nc" id="L588">			chartB_lineChart.getData().add(series);</span>
<span class="nc" id="L589">		});</span>

<span class="nc" id="L591">		textAreaConsole.setText(&quot;COVID-19 deaths chart generated successfully.&quot;);</span>
<span class="nc" id="L592">	}</span>

	public void handleMenuClose(Event event) {
<span class="nc" id="L595">		Integer selected = 0;</span>
<span class="nc" id="L596">		var menu = (MenuButton) event.getSource();</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">		for(MenuItem item: menu.getItems()) {</span>
<span class="nc" id="L598">			CustomMenuItem checkItem = (CustomMenuItem) item;</span>
<span class="nc" id="L599">			CheckBox checkBox = (CheckBox) checkItem.getContent();</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">			if (checkBox.isSelected()) {</span>
<span class="nc" id="L601">				selected += 1;</span>
			}
<span class="nc" id="L603">		}</span>
<span class="nc" id="L604">		menu.setText(String.format(&quot;%d countries selected&quot;, selected));</span>
<span class="nc" id="L605">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>